<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω d√≤ng ti·ªÅn & Th·ªëng k√™ - Viettel Post</title>
    <link rel="stylesheet" href="assets/cargo-value.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>

    <div class="page-container">
        <nav class="tab-nav">
            <a href="#thong-ke" class="tab-link active" data-tab="thong-ke">Th·ªëng k√™</a>
            <a href="#dong-tien" class="tab-link" data-tab="dong-tien">D√≤ng ti·ªÅn</a>
        </nav>

        <main>
            <div id="thong-ke" class="tab-content active">
                <div class="stats-header">
                    <div class="header-left">
                        <h2>Ti·ªÅn h√†ng theo tr·∫°ng th√°i (T√≠nh theo ng√†y g·ª≠i)</h2>
                        <div class="total-orders"><span>S·ªë l∆∞·ª£ng ƒë∆°n h√†ng</span><b>0</b></div>
                    </div>
                    <div class="header-right">
                        <div class="summary-item"><span>T·ªïng ti·ªÅn thu h·ªô <i class="fa-regular fa-circle-question"></i></span><b>0 ‚Ç´</b></div>
                        <div class="summary-item"><span>T·ªïng ti·ªÅn c∆∞·ªõc <i class="fa-regular fa-circle-question"></i></span><b>0 ‚Ç´</b></div>
                        <div class="filter-control dropdown-wrapper"><select><option>COD g·ªìm c∆∞·ªõc ng∆∞·ªùi nh·∫≠n tr·∫£</option><option>COD kh√¥ng g·ªìm c∆∞·ªõc ng∆∞·ªùi nh·∫≠n tr·∫£</option></select></div>
                        <div class="filter-control date-picker-wrapper"><input type="text" id="statsDatePicker" placeholder="Ch·ªçn kho·∫£ng th·ªùi gian"><i class="fa-regular fa-calendar-days calendar-icon"></i></div>
                    </div>
                </div>
                <div class="stats-body">
                    <div class="chart-container card"><div class="chart-placeholder circle"></div></div>
                    <div class="tables-container">
                        <div class="table-card card">
                             <table>
                                <thead><tr><th>Tr·∫°ng th√°i</th><th>S·ªë ƒë∆°n</th><th>Ti·ªÅn thu h·ªô (VNƒê)</th><th>Ti·ªÅn c∆∞·ªõc</th></tr></thead>
                                <tbody>
                                    <tr><td><span class="dot" style="background-color: #f0ad4e;"></span>ƒê·ªëi so√°t</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #9b59b6;"></span>ƒêang v·∫≠n chuy·ªÉn</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #5bc0de;"></span>ƒêang giao h√†ng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #777;"></span>Ch·ªù ph√°t l·∫°i</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #5cb85c;"></span>Giao th√†nh c√¥ng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #8d6e63;"></span>Ch·ªù x·ª≠ l√Ω</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                </tbody>
                            </table>
                        </div>
                         <div class="table-card card">
                             <table>
                                <thead><tr><th>Tr·∫°ng th√°i kh√°c <i class="fa-regular fa-circle-question"></i></th><th>S·ªë ƒë∆°n</th><th>Ti·ªÅn thu h·ªô (VNƒê)</th><th>Ti·ªÅn c∆∞·ªõc</th></tr></thead>
                                <tbody>
                                    <tr><td><span class="dot" style="background-color: #337ab7;"></span>T·∫°o m·ªõi</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #81d4fa;"></span>ƒê√£ ti·∫øp nh·∫≠n</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #81d4fa;"></span>ƒêang l·∫•y h√†ng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr class="active-row"><td><span class="dot" style="background-color: #ef4444;"></span>T·ªìn - L·∫•y kh√¥ng th√†nh c√¥ng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #bcaaa4;"></span>ƒê√£ h·ªßy giao</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #ef4444;"></span>VTP h·ªßy l·∫•y</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #ffcc80;"></span>Shop h·ªßy l·∫•y</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #ffd600;"></span>ƒêang x√°c minh b·ªìi th∆∞·ªùng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                    <tr><td><span class="dot" style="background-color: #bcaaa4;"></span>ƒê√£ b·ªìi th∆∞·ªùng</td><td>0</td><td>0 ‚Ç´</td><td>0 ‚Ç´</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dong-tien" class="tab-content">
                 <div class="cashflow-header">
                    <div class="header-left">
                        <h1>Qu·∫£n l√Ω d√≤ng ti·ªÅn</h1>
                        <span>(C·∫≠p nh·∫≠t l·∫ßn cu·ªëi l√∫c 23:03)</span>
                    </div>
                    <div class="header-right">
                        <div class="cash-summary-item blue"><i class="fa-solid fa-wallet"></i><div><span>S·ªë d∆∞ <i class="fa-regular fa-circle-question"></i></span><b>0 ‚Ç´</b></div></div>
                        <div class="cash-summary-item red-outline"><i class="fa-solid fa-money-bill-transfer"></i><div><span>R√∫t ti·ªÅn</span><b>0 ‚Ç´</b></div></div>
                        <div class="cash-summary-item white"><i class="fa-solid fa-hand-holding-dollar"></i><div><span>N·∫°p c∆∞·ªõc <i class="fa-regular fa-circle-question"></i></span><b>0 ‚Ç´</b></div></div>
                        <button class="btn btn-red">Thanh to√°n</button>
                    </div>
                </div>
                <div class="cashflow-body">
                    <div class="cashflow-column">
                        <h2>Ti·ªÅn h√†ng</h2>
                        <div class="card-row">
                            <div class="info-card card"><span>ƒêang lu√¢n chuy·ªÉn</span><b>0 ‚Ç´</b><i class="fa-solid fa-arrow-right-long"></i></div>
                            <div class="info-card card"><span>Ch·ªù tr·∫£</span><b>0 ‚Ç´</b><i class="fa-solid fa-arrow-right-long"></i></div>
                        </div>
                        <div class="chart-card card">
                            <div class="chart-header">
                                <div>
                                    <h3>Th√¥ng tin k√™ ti·ªÅn h√†ng <i class="fa-regular fa-circle-question"></i></h3>
                                    <span class="chart-subtitle">(ƒê∆°n v·ªã t√≠nh: VNƒê)</span>
                                </div>
                                <div class="chart-legend">
                                    <span><span class="dot" style="background-color: #ffc107;"></span>Ti·ªÅn thu h·ªô</span>
                                    <span><span class="dot" style="background-color: #28a745;"></span>Ti·ªÅn h√†ng ho√†n</span>
                                    <span><span class="dot" style="background-color: #007bff;"></span>Ti·ªÅn ƒë√£ tr·∫£</span>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <a href="#" class="chart-link">Xem DS b·∫£ng k√™ ƒë√£ tr·∫£</a>
                                <div class="filter-control date-picker-wrapper">
                                    <input type="text" class="date-range-picker-simple" placeholder="Ch·ªçn ng√†y">
                                    <i class="fa-regular fa-calendar-days calendar-icon"></i>
                                </div>
                            </div>
                            <div class="chart-placeholder-area">
                                <svg width="100%" height="250" class="line-chart-svg">
                                    <text x="0" y="245" dy=".3em">0</text><text x="0" y="195" dy=".3em">200k</text><text x="0" y="145" dy=".3em">400k</text><text x="0" y="95" dy=".3em">600k</text><text x="0" y="45" dy=".3em">800k</text><text x="0" y="5" dy=".3em">1Tr</text>
                                    <line x1="40" y1="245" x2="100%" y2="245"></line><line x1="40" y1="195" x2="100%" y2="195"></line><line x1="40" y1="145" x2="100%" y2="145"></line><line x1="40" y1="95" x2="100%" y2="95"></line><line x1="40" y1="45" x2="100%" y2="45"></line>
                                    <polyline points="80,245 150,245 220,245 290,245 360,245 430,245 500,245 570,245" />
                                    <circle cx="80" cy="245" r="4"></circle><circle cx="150" cy="245" r="4"></circle><circle cx="220" cy="245" r="4"></circle><circle cx="290" cy="245" r="4"></circle><circle cx="360" cy="245" r="4"></circle><circle cx="430" cy="245" r="4"></circle><circle cx="500" cy="245" r="4"></circle><circle cx="570" cy="245" r="4"></circle>
                                    <text x="80" y="265">01/10</text><text x="150" y="265">02/10</text><text x="220" y="265">03/10</text><text x="290" y="265">04/10</text><text x="360" y="265">05/10</text><text x="430" y="265">06/10</text><text x="500" y="265">07/10</text><text x="570" y="265">08/10</text>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="cashflow-column">
                        <h2>C∆∞·ªõc ph√≠</h2>
                        <div class="card-row">
                            <div class="info-card card"><span>N·ª£ c∆∞·ªõc ch∆∞a tr·∫£</span><b>0 ‚Ç´</b><i class="fa-solid fa-arrow-right-long"></i></div>
                            <div class="info-card card"><span>T·ªïng c∆∞·ªõc ƒë√£ tr·∫£ (7 ng√†y qua)</span><b>0 ‚Ç´</b><i class="fa-solid fa-arrow-right-long"></i></div>
                        </div>
                        <div class="chart-card card">
                            <div class="chart-header">
                                <h3>Th√¥ng tin k√™ c∆∞·ªõc ph√≠ <i class="fa-regular fa-circle-question"></i></h3>
                                 <div class="filter-control date-picker-wrapper">
                                    <input type="text" class="date-range-picker-simple" placeholder="Ch·ªçn ng√†y">
                                    <i class="fa-regular fa-calendar-days calendar-icon"></i>
                                </div>
                            </div>
                             <div class="chart-placeholder-area bar-chart">
                                <div class="bar-chart-y-axis">
                                    <span>T·ªïng c∆∞·ªõc ph√≠</span><span>Ph√≠ giao h√†ng</span><span>Ph√≠ ho√†n</span><span>Ph√≠ chuy·ªÉn ti·∫øp</span>
                                </div>
                                <div class="bar-chart-grid">
                                    <div class="bar-chart-x-axis">
                                        <span>0</span><span>100k</span><span>200k</span><span>300k</span><span>400k</span><span>500k</span><span>600k</span><span>700k</span><span>800k</span><span>900k</span><span>1Tr</span>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <button class="chat-button"><i class="fa-solid fa-comment-dots"></i></button>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/vn.js"></script>
    <script>
    // --- B·ªåC T·∫§T C·∫¢ V√ÄO H√ÄM INIT ---
    function initCargoValuePage() {
        console.log("üöÄ Initializing Cargo Value Page UI..."); // Th√™m log
        // --- Tab Switching ---
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabContents = document.querySelectorAll('.tab-content');
        tabLinks.forEach(link => {
            // X√≥a listener c≈© tr∆∞·ªõc khi th√™m m·ªõi (ƒë·ªÅ ph√≤ng g·ªçi init nhi·ªÅu l·∫ßn)
            link.removeEventListener('click', handleTabClick);
            link.addEventListener('click', handleTabClick);
        });

        function handleTabClick(e) {
             e.preventDefault();
             const targetTab = e.currentTarget.dataset.tab;
             console.log(` M·ªü tab: ${targetTab}`);
             tabLinks.forEach(l => l.classList.remove('active'));
             tabContents.forEach(c => c.classList.remove('active'));
             e.currentTarget.classList.add('active');
             const targetContent = document.getElementById(targetTab);
             if (targetContent) targetContent.classList.add('active');
        }


        // --- Date Picker cho tab Th·ªëng k√™ (ph·ª©c t·∫°p) ---
         // Th√™m ki·ªÉm tra n·∫øu flatpickr t·ªìn t·∫°i
        if (typeof flatpickr !== 'undefined') {
            flatpickr("#statsDatePicker", {
                mode: "range", dateFormat: "d/m/Y", locale: "vn",
                defaultDate: ["25/09/2025", "08/10/2025"], showMonths: 2,
                onReady: function(selectedDates, dateStr, instance) {
                    console.log("üìÖ Flatpickr #statsDatePicker s·∫µn s√†ng.");
                    const shortcuts = document.createElement('div');
                    shortcuts.className = 'flatpickr-shortcuts';
                    const options = ['H√¥m nay', 'H√¥m qua', '7 ng√†y tr∆∞·ªõc', '14 ng√†y tr∆∞·ªõc', '30 ng√†y tr∆∞·ªõc', 'Th√°ng n√†y', 'Th√°ng tr∆∞·ªõc'];

                    options.forEach(optionText => {
                        const btn = document.createElement('button');
                        btn.className = 'shortcut-button';
                        // ƒê·∫∑t active d·ª±a tr√™n defaultDate (14 ng√†y tr∆∞·ªõc)
                        const fourteenDaysAgo = new Date();
                        fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 13);
                        const defaultStart = new Date("2025-09-25"); // L·∫•y t·ª´ defaultDate
                         // So s√°nh ng√†y thay v√¨ to√†n b·ªô Date object
                        if (optionText === '14 ng√†y tr∆∞·ªõc' &&
                            fourteenDaysAgo.toDateString() === defaultStart.toDateString() ) {
                               btn.classList.add('active');
                        }

                        btn.textContent = optionText;
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const now = new Date();
                            let start = new Date(now), end = new Date(now);
                            // ... (switch case gi·ªØ nguy√™n) ...
                             switch(optionText) {
                                case 'H√¥m nay': break;
                                case 'H√¥m qua': start.setDate(now.getDate() - 1); end.setDate(now.getDate() - 1); break;
                                case '7 ng√†y tr∆∞·ªõc': start.setDate(now.getDate() - 6); break;
                                case '14 ng√†y tr∆∞·ªõc': start.setDate(now.getDate() - 13); break;
                                case '30 ng√†y tr∆∞·ªõc': start.setDate(now.getDate() - 29); break;
                                case 'Th√°ng n√†y': start = new Date(now.getFullYear(), now.getMonth(), 1); end = new Date(now.getFullYear(), now.getMonth() + 1, 0); break;
                                case 'Th√°ng tr∆∞·ªõc': start = new Date(now.getFullYear(), now.getMonth() - 1, 1); end = new Date(now.getFullYear(), now.getMonth(), 0); break;
                            }
                            // B·ªè active t·∫•t c·∫£ n√∫t shortcut kh√°c
                            shortcuts.querySelectorAll('.shortcut-button').forEach(b => b.classList.remove('active'));
                            e.target.classList.add('active'); // ƒê·∫∑t active cho n√∫t ƒë∆∞·ª£c click
                            instance.setDate([start, end], true); // C·∫≠p nh·∫≠t l·ªãch v√† trigger onChange
                        });
                        shortcuts.appendChild(btn);
                    });
                     // Ch√®n shortcuts v√†o ƒë·∫ßu calendarContainer
                    if (instance.calendarContainer) {
                        instance.calendarContainer.prepend(shortcuts);
                    } else {
                        console.warn("‚ö†Ô∏è calendarContainer kh√¥ng t√¨m th·∫•y ƒë·ªÉ ch√®n shortcuts.");
                    }
                },
                // --- TH√äM onChange ƒê·ªÇ G·ªåI L·∫†I API ---
                onChange: function(selectedDates, dateStr, instance) {
                    if (selectedDates.length === 2) {
                        console.log("üóìÔ∏è Date range #statsDatePicker thay ƒë·ªïi, t·∫£i l·∫°i CargoData...");
                         // B·ªè active t·∫•t c·∫£ n√∫t shortcut khi ch·ªçn ng√†y th·ªß c√¥ng
                         instance.calendarContainer.querySelectorAll('.shortcut-button').forEach(b => b.classList.remove('active'));

                        if (window.CargoData && typeof window.CargoData.init === 'function') {
                             // G·ªçi l·∫°i init ƒë·ªÉ load l·∫°i d·ªØ li·ªáu v·ªõi ng√†y m·ªõi
                             window.CargoData.init();
                        } else {
                            console.error("‚ùå CargoData.init kh√¥ng kh·∫£ d·ª•ng khi date range thay ƒë·ªïi!");
                        }
                    }
                }
                 // --- K·∫æT TH√öC onChange ---
            });

             // --- Date Picker cho tab D√≤ng ti·ªÅn (ƒë∆°n gi·∫£n) ---
             document.querySelectorAll('.date-range-picker-simple').forEach(picker => {
                 flatpickr(picker, {
                     mode: "range",
                     dateFormat: "d/m/Y",
                     locale: "vn",
                     defaultDate: ["01/10/2025", "08/10/2025"],
                     // --- TH√äM onChange (n·∫øu c·∫ßn load l·∫°i ph·∫ßn bi·ªÉu ƒë·ªì d√≤ng ti·ªÅn) ---
                     onChange: function(selectedDates, dateStr, instance) {
                         if (selectedDates.length === 2) {
                             const from = selectedDates[0].toISOString();
                             const to = selectedDates[1].toISOString();
                             console.log(`üóìÔ∏è Date range simple picker thay ƒë·ªïi: ${from} to ${to}. TODO: T·∫£i l·∫°i d·ªØ li·ªáu bi·ªÉu ƒë·ªì n·∫øu c·∫ßn.`);
                             // V√≠ d·ª•: if (window.SomeChartModule) { window.SomeChartModule.loadChartData(from, to); }
                         }
                     }
                     // --- K·∫æT TH√öC onChange ---
                 });
             });

        } else {
            console.error("‚ùå Th∆∞ vi·ªán Flatpickr ch∆∞a ƒë∆∞·ª£c t·∫£i!");
             // C√≥ th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o l·ªói cho ng∆∞·ªùi d√πng
             const datePickers = document.querySelectorAll('#statsDatePicker, .date-range-picker-simple');
             datePickers.forEach(dp => dp.placeholder = "L·ªói t·∫£i l·ªãch");
        }


        // --- Clickable Table Rows ---
        const allTableRows = document.querySelectorAll('.table-card tbody tr');
        allTableRows.forEach(row => {
             row.removeEventListener('click', handleTableRowClick); // X√≥a listener c≈©
             row.addEventListener('click', handleTableRowClick); // Th√™m listener m·ªõi
        });

         function handleTableRowClick(event) {
             console.log("üñ±Ô∏è Clicked table row");
             // B·ªè active t·∫•t c·∫£ c√°c d√≤ng trong c√πng b·∫£ng ho·∫∑c t·∫•t c·∫£ c√°c b·∫£ng
             const parentTable = event.currentTarget.closest('table');
             parentTable.querySelectorAll('tbody tr').forEach(r => r.classList.remove('active-row'));
             // ƒê·∫∑t active cho d√≤ng ƒë∆∞·ª£c click
             event.currentTarget.classList.add('active-row');
         }

        // --- G·ªåI H√ÄM T·∫¢I D·ªÆ LI·ªÜU T·ª™ cargo-data.js ---
        if (window.CargoData && typeof window.CargoData.init === 'function') {
            console.log("üöÄ Calling CargoData.init() from cargo-value.html");
            window.CargoData.init(); // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
        } else {
            console.error("‚ùå CargoData or CargoData.init not available!");
             // Hi·ªÉn th·ªã l·ªói tr√™n UI
             showGenericErrorUI("L·ªói: Kh√¥ng th·ªÉ t·∫£i module d·ªØ li·ªáu d√≤ng ti·ªÅn.");
        }
        // --- K·∫æT TH√öC G·ªåI H√ÄM T·∫¢I D·ªÆ LI·ªÜU ---

        console.log("‚úÖ Cargo Value Page UI Initialized"); // Th√™m log cu·ªëi
    } // --- End initCargoValuePage ---

    // --- Helper function to show generic errors ---
     function showGenericErrorUI(message) {
         const mainContainer = document.querySelector('main');
         if (!mainContainer) return;
         let errorDiv = mainContainer.querySelector('.generic-error-ui');
         if (!errorDiv) {
             errorDiv = document.createElement('div');
             errorDiv.className = 'generic-error-ui';
             errorDiv.style.cssText = "background:#f8d7da; color:#721c24; padding:10px 15px; margin:15px 0; text-align:center; border:1px solid #f5c6cb; border-radius: 6px; font-size:14px;";
             mainContainer.prepend(errorDiv); // Th√™m v√†o ƒë·∫ßu th·∫ª main
         }
         errorDiv.textContent = message;
     }


    // --- LOGIC KI·ªÇM TRA ƒê·ªÇ G·ªåI H√ÄM INIT ---
    if (document.readyState === "loading") {
        // Ch·∫°y ƒë·ªôc l·∫≠p: ƒê·ª£i DOM load xong
        document.addEventListener("DOMContentLoaded", initCargoValuePage);
    } else {
        // Ch·∫°y qua index.html (DOM ƒë√£ load): Ch·∫°y ngay!
        initCargoValuePage();
    }
    </script>
    <script src="assets/api/config.js"></script>
    <script src="assets/api/cargo-data.js"></script> </body>
</html>